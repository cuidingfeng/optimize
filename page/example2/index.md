# css、js合并打包、压缩

上一节[雪碧图CSS sprite、字体图标](example1/index.md)中我们把图片合并了，这一节我们合并css和js。上一节说过，每一个http请求都需要一些额外的时间，比如建立连接、请求头、响应头、文件头等，这些都需要资源和时间，所以我们的目标同样是减少http请求，减少页面加载的css和js的文件数量。

首先我们了解一下，为什么页面上会有大量的css文件和js文件。还是从历史开始，最早期网页刚出现时，浏览器的能力还没现在这么强大，产品需求也很简单，页面上就是简单的内容展示，加少量的js用户交互。所以，那时候一个页面或一类页面上的所有样式都写到一个css文件里、所有脚本都写到一个js文件里，也没有很多，不用显的很乱，维护起来问题不大。

后面浏览器功能越来越强大，能做更多更难的事情，产品的需求也就跟着越来越复杂，代码也就越来越多，越来越难以维护。逐渐的前端css和js有了组件化和模块化的概念，把复杂的任务分解为多个独立的小任务。虽然文件的组织结构复杂了，但是每一个文件的内容变简单了，好维护了。所以，这时候，我们页面上就需要加载很多小文件了。

现在我们知道了，为了开发时更容易维护代码，所以我们希望把代码分解了很多个小文件；为了浏览器加载时得到更好的性能，我们又希望把代码合并为尽量少的文件，最好是只有一个文件。那这就矛盾了，我们到底要分解还是要合并。

这个问题的解决方案是，我们两者都要，开发时，我们的源码是分解的小文件；上线时，我们把文件合并生成大文件，让用户的浏览器只加载少量的文件。看上去这是完美的，但是如果每次上线都要程序员手动合并文件，那工作量会非常大，搞错的概率也会非常大。

还好有node.js，聪明的前端工程师们用nodejs开发了一些工具，这些工具可以全自动完全上面合并文件的任务，解放了人类，并且几乎不会出错，还能在很短的时间（秒级别）内完成任务。

对了，我们本节的标题还提到了压缩，因为我们现在已经由工具来处理代码了，所以当代码被合并完成后，工具还可以顺便对合并完成的代码做个压缩甚至混淆，进一步减小文件的体积。

多说一句，基于node的这些工具的出现，让前端进入了工程化时代，这是革命性的质变。

## 具体怎么做？

说了这么多，具体该怎么做，有什么效果？

首先我们还是介绍一下业界使用最多的构建工具，为什么叫构建工具？是因为它们不只是用来实现代码打包合并，而是可以做工程化相关的几乎任何事情。我印象里最早的就是Grunt、FIS，后面还有Gulp，而目前最火热的是Webpack。这4个工具里，FIS是百度开源出品的，其它三个都是国外的。

这里多说一下我和FIS的故事，大概6年前，有幸去百度听内部技术分享，认识了当时百度FEX负责人[张云龙](https://github.com/fouber)大神，那时候FIS2刚开源（FIS1一直只在百度内部使用过），我就从此走上的前端工程化的道路。经过长时间对张云龙大神的骚扰请教，我在公司大力推广使用FIS2，对FIS有了深厚的感情。没过多久，大概一年左右，FIS3就面世了，FIS3比FIS2的架构更加灵活，功能更加强大，我也及时转向了FIS3，一直用到现在。在此也特别感谢在使用FIS3的过程中，FIS3的主要开发者[廖学之](https://github.com/2betop)大佬的帮忙。

好了，现在我们说正经的，这几个工具能做的事差不多，但是设计思路各自不同，所以用法不同。既然WebPack现在最流行，我们就拿它做例子。

## 看看实例

可以把本项目代码clone到本地，在本地环境启动服务

```
npm i
npm start
```

### 实例一：普通未打包css、js的页面


[查看源码](demo1.html) -
[本地预览](http://127.0.0.1:8083/page/example2/demo1.html)

